import{r as N}from"./index-D2elhMP6.js";const b=(e,t)=>t.some(n=>e instanceof n);let S,E;function T(){return S||(S=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function L(){return E||(E=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const D=new WeakMap,y=new WeakMap,m=new WeakMap;function C(e){const t=new Promise((n,r)=>{const o=()=>{e.removeEventListener("success",s),e.removeEventListener("error",a)},s=()=>{n(u(e.result)),o()},a=()=>{r(e.error),o()};e.addEventListener("success",s),e.addEventListener("error",a)});return m.set(t,e),t}function O(e){if(D.has(e))return;const t=new Promise((n,r)=>{const o=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",a),e.removeEventListener("abort",a)},s=()=>{n(),o()},a=()=>{r(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",s),e.addEventListener("error",a),e.addEventListener("abort",a)});D.set(e,t)}let I={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return D.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return u(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function P(e){I=e(I)}function p(e){return L().includes(e)?function(...t){return e.apply(g(this),t),u(this.request)}:function(...t){return u(e.apply(g(this),t))}}function v(e){return typeof e=="function"?p(e):(e instanceof IDBTransaction&&O(e),b(e,T())?new Proxy(e,I):e)}function u(e){if(e instanceof IDBRequest)return C(e);if(y.has(e))return y.get(e);const t=v(e);return t!==e&&(y.set(e,t),m.set(t,e)),t}const g=e=>m.get(e);function V(e,t,{blocked:n,upgrade:r,blocking:o,terminated:s}={}){const a=indexedDB.open(e,t),w=u(a);return r&&a.addEventListener("upgradeneeded",c=>{r(u(a.result),c.oldVersion,c.newVersion,u(a.transaction),c)}),n&&a.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),w.then(c=>{s&&c.addEventListener("close",()=>s()),o&&c.addEventListener("versionchange",d=>o(d.oldVersion,d.newVersion,d))}).catch(()=>{}),w}const F=["get","getKey","getAll","getAllKeys","count"],W=["put","add","delete","clear"],l=new Map;function x(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(l.get(t))return l.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,o=W.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(o||F.includes(n)))return;const s=async function(a,...w){const c=this.transaction(a,o?"readwrite":"readonly");let d=c.store;return r&&(d=d.index(w.shift())),(await Promise.all([d[n](...w),o&&c.done]))[0]};return l.set(t,s),s}P(e=>({...e,get:(t,n,r)=>x(t,n)||e.get(t,n,r),has:(t,n)=>!!x(t,n)||e.has(t,n)}));const k=["continue","continuePrimaryKey","advance"],A={},B=new WeakMap,j=new WeakMap,R={get(e,t){if(!k.includes(t))return e[t];let n=A[t];return n||(n=A[t]=function(...r){B.set(this,j.get(this)[t](...r))}),n}};async function*K(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const n=new Proxy(t,R);for(j.set(n,t),m.set(n,g(t));t;)yield n,t=await(B.get(n)||t.continue()),B.delete(n)}function M(e,t){return t===Symbol.asyncIterator&&b(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&b(e,[IDBIndex,IDBObjectStore])}P(e=>({...e,get(t,n,r){return M(t,n)?K:e.get(t,n,r)},has(t,n){return M(t,n)||e.has(t,n)}}));const _="notesDB",i="notes",f="settings",h=async()=>V(_,3,{upgrade(e){e.objectStoreNames.contains(i)||e.createObjectStore(i,{keyPath:"id",autoIncrement:!0}).createIndex("createdAt","createdAt",{unique:!1}),e.objectStoreNames.contains(f)||e.createObjectStore(f)}}),Q=async e=>{const n=(await h()).transaction(i,"readwrite"),r=n.objectStore(i),o=await r.get(e.id),s=JSON.parse(JSON.stringify(e));o?s.createdAt=o.createdAt:s.createdAt=Date.now(),await r.put(s),await n.done},U=async()=>(await(await h()).transaction(i,"readonly").objectStore(i).getAll()).sort((o,s)=>s.createdAt-o.createdAt),X=async e=>{const n=(await h()).transaction(i,"readwrite");await n.objectStore(i).delete(e),await n.done},J=async(e,t)=>{const r=(await h()).transaction(f,"readwrite");await r.objectStore(f).put(t,e),await r.done},G=async e=>(await h()).transaction(f,"readonly").objectStore(f).get(e),$=N("light"),z=async e=>{$.value=e,document.documentElement.setAttribute("data-theme",e),await J("theme",e)},Y=async()=>{const t=await G("theme")||"light";await z(t)};export{z as a,X as d,U as g,Y as i,Q as s,$ as t};
