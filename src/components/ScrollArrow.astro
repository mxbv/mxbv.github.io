---
import Icon from "./Icon.astro";
---

<div
  id="scroll-arrow"
  class="fixed bottom-24 right-6 z-50 transition-all duration-300"
>
  <button
    id="scroll-button"
    class="w-12 h-12 rounded-full bg-surface-dark border border-surface-border flex items-center justify-center text-white transition-all group"
    aria-label="Scroll to bottom"
  >
    <span id="scroll-icon" class="inline-flex items-center justify-center">
      <Icon
        name="keyboard_arrow_down"
        size={24}
        class="transition-all duration-300 group-hover:scale-110"
      />
    </span>
  </button>
</div>

<style>
  #scroll-icon {
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  #scroll-icon.rotate-up {
    transform: rotate(180deg);
  }

  #scroll-icon.rotate-down {
    transform: rotate(0deg);
  }
</style>

<script>
  (function () {
    if (typeof document === "undefined" || typeof window === "undefined")
      return;

    const scrollButton = document.getElementById("scroll-button");
    const scrollIcon = document.getElementById("scroll-icon");
    const scrollArrow = document.getElementById("scroll-arrow");
    const contactSection = document.getElementById("contact");

    if (!scrollButton || !scrollIcon || !scrollArrow) return;

    function updateScrollButton() {
      if (!contactSection || !scrollIcon || !scrollButton) return;

      const contactRect = contactSection.getBoundingClientRect();
      // Проверяем, видна ли секция контактов в области просмотра
      // Переключаем стрелку, когда верхняя граница секции находится в верхней трети экрана
      const isContactVisible = contactRect.top <= window.innerHeight * 0.3 && contactRect.bottom > 0;

      if (isContactVisible) {
        // Показываем стрелку вверх с анимацией разворота
        scrollIcon.classList.remove("rotate-down");
        scrollIcon.classList.add("rotate-up");
        scrollButton.setAttribute("aria-label", "Scroll to top");
      } else {
        // Показываем стрелку вниз с анимацией разворота
        scrollIcon.classList.remove("rotate-up");
        scrollIcon.classList.add("rotate-down");
        scrollButton.setAttribute("aria-label", "Scroll to bottom");
      }
    }

    function handleScroll() {
      updateScrollButton();
    }

    function handleClick() {
      if (!contactSection) return;

      const contactRect = contactSection.getBoundingClientRect();
      // Используем ту же логику, что и в updateScrollButton
      const isContactVisible = contactRect.top <= window.innerHeight * 0.3 && contactRect.bottom > 0;

      if (isContactVisible) {
        // Скроллим наверх
        window.scrollTo({
          top: 0,
          behavior: "smooth",
        });
      } else {
        // Скроллим к контактам
        contactSection.scrollIntoView({
          behavior: "smooth",
          block: "start",
        });
      }
    }

    // Инициализация
    updateScrollButton();
    scrollButton.addEventListener("click", handleClick);
    window.addEventListener("scroll", handleScroll, { passive: true });
    window.addEventListener("resize", updateScrollButton, { passive: true });
  })();
</script>
